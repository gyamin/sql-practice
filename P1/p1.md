## キーが重複すればupdate、キーが重複しなければinsert 複数行版

### 初期状態
stageテーブル

| Field | Type | Null | Key | Default | Extra |
| :--- | :--- | :--- | :--- | :--- | :--- |
| id | int | NO | PRI | NULL | auto\_increment |
| user\_id | int | YES | UNI | NULL |  |
| stage | int | YES |  | NULL |  |

```
select * from stages;
```
| id | user\_id | stage |
| :--- | :--- | :--- |
| 1 | 1 | 1 |
| 2 | 2 | 1 |
| 3 | 3 | 1 |
| 4 | 4 | 1 |
| 5 | 5 | 1 |

### キーが重複すればupdate、重複しなければinsertの例

user_id=1のstage=10 に更新
user_id=2のstage=11 に更新
user_id=3のstage=12 に更新
user_id=6、stage=100 を挿入

```
INSERT INTO stages (user_id, stage) VALUES (1, 10), (2,11), (3,12), (6,100)
ON DUPLICATE KEY UPDATE stage = VALUES(`stage`);
```

| id | user\_id | stage |
| :--- | :--- | :--- |
| 1 | 1 | 10 |
| 2 | 2 | 11 |
| 3 | 3 | 12 |
| 4 | 4 | 1 |
| 5 | 5 | 1 |
| 10 | 6 | 100 |
